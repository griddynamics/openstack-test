Feature: Start instance(s) in single node deployment using  python-novaclient CLI
    In order to smoke test OpenStack build
    As tester
    I want to register start instance and verify it is up and available via SSH

    Scenario: Setup prerequisites
        Require setup "single-node ! novaclient-users ! novaclient-network ! novaclient-images ! novaclient-keys"


    Scenario: Start single instance and bind with pre-uploaded keypair
        Given novarc for project "{{project.name}}", user "{{user.name}}" is available
        And VM image "{{image.name}}" is registered
        And keypair with name "{{vm.keypair.name}}" exists
        When I start VM instance "{{vm.name}}" using image "{{image.name}}",  flavor "{{vm.flavor}}" and keypair "{{vm.keypair.name}}"
        Then VM instance "{{vm.name}}" comes up within "{{vm.boot_timeout}}" seconds
        And VM instance "{{vm.name}}" is pingable within "{{vm.ping_deadline}}" seconds
        And I see that "ssh" port of VM instance "{{vm.name}}" is open and serves "ssh" protocol
        #And I can log into VM "{{vm.name}}" via SSH as "{{vm.user}}"
        And I can log into VM "{{vm.name}}" via SSH as "{{vm.user}}" with key "{{vm.keypair.private}}"


    Scenario: Start single instance and login with auto-generated root password
        Given novarc for project "{{project.name}}", user "{{user.name}}" is available
        And VM image "{{image.name}}" is registered
        When I start VM instance "{{vm2.name}}" using image "{{image.name}}",  flavor "{{vm2.flavor}}" and save auto-generated password
        Then VM instance "{{vm2.name}}" comes up within "{{vm2.boot_timeout}}" seconds
        And VM instance "{{vm2.name}}" is pingable within "{{vm2.ping_deadline}}" seconds
        And I see that "ssh" port of VM instance "{{vm2.name}}" is open and serves "ssh" protocol
        And I can log into VM "{{vm2.name}}" via SSH as "{{vm2.user}}" using saved password

    Scenario: Start multiple instances with same name
        When I start VM instance "{{vm3.name}}" using image "{{image.name}}", flavor "{{vm3.flavor}}"
        And I change flag file "{{nova.conf_file}}" by setting flag values:
                                      |     Name           | Value |
                                      | project_uniq_names | true  |
        Then I can not start VM instance "{{vm3.name}}" using image "{{image.name}}", flavor "{{vm3.flavor}}"
        When I change flag file "{{nova.conf_file}}" by setting flag values:
                                      |     Name           | Value |
                                      | project_uniq_names | false |
        Then I start VM instance "{{vm3.name}}" using image "{{image.name}}", flavor "{{vm3.flavor}}"